<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations | Joao Lage</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations" />
<meta name="author" content="Joao Lage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations." />
<meta property="og:description" content="Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations." />
<link rel="canonical" href="https://joaolage.com/notes-simclr-framework" />
<meta property="og:url" content="https://joaolage.com/notes-simclr-framework" />
<meta property="og:site_name" content="Joao Lage" />
<meta property="og:image" content="https://joaolage.com/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-05T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://joaolage.com/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg" />
<meta property="twitter:title" content="Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations" />
<meta name="twitter:site" content="@_joaolage" />
<meta name="twitter:creator" content="@Joao Lage" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Joao Lage"},"headline":"Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations","description":"Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations.","datePublished":"2020-04-05T00:00:00-05:00","dateModified":"2020-04-05T00:00:00-05:00","image":"https://joaolage.com/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://joaolage.com/notes-simclr-framework"},"url":"https://joaolage.com/notes-simclr-framework","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://joaolage.com/feed.xml" title="Joao Lage" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations | Joao Lage</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations" />
<meta name="author" content="Joao Lage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations." />
<meta property="og:description" content="Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations." />
<link rel="canonical" href="https://joaolage.com/notes-simclr-framework" />
<meta property="og:url" content="https://joaolage.com/notes-simclr-framework" />
<meta property="og:site_name" content="Joao Lage" />
<meta property="og:image" content="https://joaolage.com/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-05T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://joaolage.com/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg" />
<meta property="twitter:title" content="Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations" />
<meta name="twitter:site" content="@_joaolage" />
<meta name="twitter:creator" content="@Joao Lage" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Joao Lage"},"headline":"Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations","description":"Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations.","datePublished":"2020-04-05T00:00:00-05:00","dateModified":"2020-04-05T00:00:00-05:00","image":"https://joaolage.com/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://joaolage.com/notes-simclr-framework"},"url":"https://joaolage.com/notes-simclr-framework","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://joaolage.com/feed.xml" title="Joao Lage" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Joao Lage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Notes on SimCLR - A Simple Framework for Contrastive Learning of Visual Representations</h1><p class="page-description">Ting Chen et al. purpose a new framework, SimCLR, based on a self-supervised contrastive-based learning of visual representations.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-04-05T00:00:00-05:00" itemprop="datePublished">
        Apr 5, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Joao Lage</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#machine-learning">machine-learning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#deep-learning">deep-learning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#tensorflow">tensorflow</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#simclr">simclr</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#self-supervised-learning">self-supervised-learning</a>
        
      
      </p>
    

    
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-04-05-notes-on-simclr.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><a href="https://arxiv.org/abs/2002.05709">A Simple Framework for Contrastive Learning of Visual Representations</a><sup id="fnref-1" class="footnote-ref"><a href="#fn-1">1</a></sup></strong>
<div class="flash">
    <svg class="octicon octicon-info" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 01-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 01-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg>
    <strong>Note: </strong>All quotes and images used in this page belong to the authors of the paper. If you intend to use them, please give the deserved credits. Furthermore, all images and tables captions map to the captions of the paper.
</div></p>
<p>This work<sup id="fnref-1" class="footnote-ref"><a href="#fn-1">1</a></sup> shows:</p>
<ul>
<li>Composition of data augmentations</li>
<li>NT-Xent, Normalized Temperature-scaled Cross-Entropy, a learnable nonlinear transformation between the representation and the contrastive loss</li>
<li>Contrastive learning benefits from larger batch sizes</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-method">The method<a class="anchor-link" href="#The-method"> </a></h2><h3 id="Composition-of-data-augmentations">Composition of data augmentations<a class="anchor-link" href="#Composition-of-data-augmentations"> </a></h3><blockquote><p>A stochastic data augmentation module that transforms any given data example randomly resulting in two correlated views of the same example denoted $\tilde{x}_i \text{and } \tilde{x}_j$, which we consider as a positive pair.</p>
<p>Composition of multiple data augmentation operations is crucial in defining the contrastive prediction tasks that yield effective representations. (...)</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/./my_icons/notes_on_simclr/simclr_transformations.jpg" alt="" />
    
    
      <figcaption>Figure 2. (partial)  A simple framework for contrastive learning of visual representations</figcaption>
    
</figure>
</p>
<ul>
<li><p>$x$ is the input image</p>
</li>
<li><p>$\tilde{x}_i \text{and } \tilde{x}_j$ are transformed images</p>
</li>
<li><p>$\mathcal{t}$ is a sequentialy applied simple augmentations</p>
</li>
<li><p>$\mathcal{T}$ is a set of simple augmentations</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-base-encoder">The base encoder<a class="anchor-link" href="#The-base-encoder"> </a></h3><p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_base_encoder.jpg" alt="" />
    
    
      <figcaption>Figure 2. (partial)  A simple framework for contrastive learning of visual representations</figcaption>
    
</figure>
</p>
<ul>
<li><p>$f(\cdot)$ is a neural network base encoder</p>
</li>
<li><p>$h_i$ and $h_j$ is the output after the average pooling layer where $h_i \in \mathbb{R}^{d}$</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-projection-head">The projection head<a class="anchor-link" href="#The-projection-head"> </a></h3><p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_framework.jpg" alt="" />
    
    
      <figcaption>Figure 2.  A simple framework for contrastive learning of visual representations</figcaption>
    
</figure>
</p>
<ul>
<li>A small neural network projection head $g(\cdot)$ that maps representations to the space where contrastive loss is applied.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-contrastive-loss-function">The contrastive loss function<a class="anchor-link" href="#The-contrastive-loss-function"> </a></h3><p>
$$ \mathsf{sim}(u,v) = \dfrac{u^\intercal v}{\|u\|\|v\|} $$
</p>
<p>
$$ \ $$
</p>
<p>
$$ \ell_{i,j} = -\log \dfrac{\exp \mathsf{sim}(z_i, z_j) / \tau}{ \sum_{k=1}^{2N} \mathbb{1}_{[k \ne i]} \exp \mathsf{sim}(z_i, z_j) / \tau} , \ \ \ \ (1) $$
</p>
<blockquote><p>Given a set $\{x_k\}$ including a positive pair of examples $x_i$ and $x_j$, the contrastive prediction task aims to identify $x_j$ in $\{\tilde{x}_k\}_{k \neq i}$ for a given $\tilde{x}_i$.</p>
<p>The final loss is computed across all positive pairs, both $(i, j)$ and $(j, i)$, in a mini-batch/</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_algo.jpg" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-tale-of-large-batch-sizes">A tale of large batch sizes<a class="anchor-link" href="#A-tale-of-large-batch-sizes"> </a></h3><blockquote><p>We do not train the model with a memory bank (<a href="https://arxiv.org/abs/1805.01978">Wu et al.,2018</a>). Instead, we vary the training batch size N from 256 to 8192.&gt; Training with large batch size may be unstable when using standard SGD/Momentum with linear learning rate scaling (Goyal et al., 2017). To stabilize the training, we use the LARS<sup id="fnref-2" class="footnote-ref"><a href="#fn-2">2</a></sup> optimizer (<a href="https://arxiv.org/pdf/2002.05709.pdf">You et al., 2017</a>) for all batch sizes.</p>
</blockquote>
<p><div class="footnotes"><p id="fn-2">2. LARS, Large Batch Training of Convolutional Networks<a href="#fnref-2" class="footnote footnotes">↩</a></p></div></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dataset-and-metrics">Dataset and metrics<a class="anchor-link" href="#Dataset-and-metrics"> </a></h3><blockquote><p>Most of our study for unsupervised pretraining (learning encoder network <em>f</em> without labels) is done using the ImageNet ILSVRC-2012 dataset (...)</p>
<p>To evaluate the learned representations, we follow the widely used <strong>linear evaluation protocol</strong> (Zhang et al., 2016; Oord et al., 2018; Bachman et al., 2019; Kolesnikov et al., 2019), where <strong>a linear classifier is trained on top of the frozen base network, and test accuracy is used as a proxy for representation quality</strong>.</p>
<p>Beyond linear evaluation, we also compare against state-of-the-art on semi-supervised and transfer learning.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Default-setting">Default setting<a class="anchor-link" href="#Default-setting"> </a></h3><blockquote><p>(...) for data augmentation we use <strong>random crop</strong> and <strong>resize (with random flip)</strong>,
<strong>color distortions</strong>, and <strong>Gaussian blur</strong> (..)</p>
</blockquote>
<ul>
<li>$\mathcal T = \{\text{crop and resize, color distortions, and Gaussian blur}\}$</li>
</ul>
<blockquote><p>We use ResNet-50 as the base encoder network (...)</p>
</blockquote>
<ul>
<li>$h_i = f(\tilde x_i) = \text{ResNet}(\tilde{x}_i)$ where $h_i \in \mathbb{R}^{2048}$</li>
</ul>
<blockquote><p>(...) 2-layer MLP projection head to project the representation to a 128-dimensional latent space (...)</p>
</blockquote>
<ul>
<li>$z_i = g(h_i) = W^{(2)}\sigma(W^{(1)}h_i),\  \sigma = \text{ReLU}$ where $z_i \in \mathbb{R}^{128}$</li>
</ul>
<blockquote><p>(...) optimized using LARS with linear learning rate scaling (i.e. $\text{LearningRate = 0.3 × BatchSize/256}$) and weight decay of $10^{-6}$. We train at batch size 4096 for 100 epochs (...)</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Augmentation-for-Contrastive-Representation-Learning">Data Augmentation for Contrastive Representation Learning<a class="anchor-link" href="#Data-Augmentation-for-Contrastive-Representation-Learning"> </a></h2><h4 id="Composition-of-data-augmentation-operations-is-crucial-for-learning-good-representations">Composition of data augmentation operations is crucial for learning good representations<a class="anchor-link" href="#Composition-of-data-augmentation-operations-is-crucial-for-learning-good-representations"> </a></h4><p>The authors decided to consider several common augmentations:</p>
<ul>
<li>spatial/geometric transformation - <strong>cropping</strong>, <strong>resizing</strong>, <strong>horizontal flipping</strong>, <strong>rotation</strong> and <strong>cutout</strong></li>
<li>appearance transformation - color distortion (including <strong>color dropping</strong>, <strong>brightness</strong>, <strong>contrast</strong>, <strong>saturation</strong>,<strong>hue</strong>), <strong>Gaussian blur</strong>, and <strong>Sobel filtering</strong></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_aug_image_matrix.jpg" alt="" />
    
    
      <figcaption>Figure 5. Linear evaluation (ImageNet top-1 accuracy) under individual or composition of data augmentations, applied only to one branch.</figcaption>
    
</figure>
</p>
<blockquote><p>We observe that no single transformation suffices to learn good representations (...) When composing augmentations, the contrastive prediction task becomes harder, but the quality of representation improves dramatically</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Random-cropping-and-random-color-distortion">Random cropping and random color distortion<a class="anchor-link" href="#Random-cropping-and-random-color-distortion"> </a></h5><p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_color_distortion.jpg" alt="" />
    
    
      <figcaption>Figure 6. Histograms of pixel intensities (over all channels) for different crops of two different images.</figcaption>
    
</figure>
</p>
<blockquote><p>Neural nets may exploit this shortcut to solve the predictive task. Therefore, <strong>it is critical to compose cropping with color distortion in order to learn generalizable features.</strong></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Findings">Findings<a class="anchor-link" href="#Findings"> </a></h2><blockquote><p>A nonlinear projection head improves the representation quality of the layer before it</p>
</blockquote>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_linear_eval_head.jpg" alt="" />
    
    
      <figcaption>Figure 8. Linear evaluation of representations with different projection heads $g(\cdot)$ and various dimensions of $z = g(h)$.</figcaption>
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Normalized cross entropy loss with adjustable temperature works better than alternatives</p>
</blockquote>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_loss_eval.jpg" alt="" />
    
    
      <figcaption>Table 4. Linear evaluation (top-1) for models trained with different
loss functions. “sh” means using semi-hard negative mining.</figcaption>
    
</figure>
</p>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_temperature_eval.jpg" alt="" />
    
    
      <figcaption>Table 5. Linear evaluation for models trained with different choices of $\ell_{2}$ norm and temperature $\tau$ for NT-Xent loss.</figcaption>
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Contrastive learning benefits (more) from larger batch sizes and longer training</p>
</blockquote>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_batch_size.jpg" alt="" />
    
    
      <figcaption>Figure 9. Linear evaluation models (ResNet-50) trained with different batch size and epochs. Each bar is a single run from scratch.</figcaption>
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Comparison with State-of-the-art</p>
</blockquote>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_results.jpg" alt="" />
    
    
      <figcaption>Table 8. Comparison of transfer learning performance of our self-supervised approach with supervised baselines across 12 natural image classification datasets, for ResNet-50 (4×) models pretrained on ImageNet.</figcaption>
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Not only does SimCLR outperform previous work (Figure 1), but it is also simpler, requiring neither specialized architectures (...)</p>
</blockquote>
<p><figure>
  
    <img class="docimage" src="/images/copied_from_nb/my_icons/notes_on_simclr/simclr_main.png" alt="" />
    
    
      <figcaption>Figure 1. ImageNet Top-1 accuracy of linear classifiers trained on representations learned with different self-supervised methods (pretrained on ImageNet).</figcaption>
    
</figure>
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusions">Conclusions<a class="anchor-link" href="#Conclusions"> </a></h2><blockquote><p>In this work, we present a simple framework and its instantiation for contrastive visual representation learning. <strong>We carefully study its components, and show the effects of different design choices.</strong></p>
<p>Our approach differs from standard supervised learning on ImageNet only in <strong>the choice of data augmentation</strong>, the use of a <strong>nonlinear head at the end of the network</strong>, and <strong>the loss function</strong>.</p>
<p>The strength of this simple framework suggests that, <strong>despite a recent surge in interest, self-supervised learning remains undervalued</strong>.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Code-samples">Code samples<a class="anchor-link" href="#Code-samples"> </a></h2><p><div class="flash">
    <svg class="octicon octicon-info octicon octicon-info" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 01-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 01-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg>
    <strong>Note: </strong>In this section I am highlighting some rather important blocks of code from the SimCLR framework using TensorFlow. These blocks taken from <a href="https://github.com/google-research/simclr">google-research/simclr</a> with some minor changes, for simplicity.
</div></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Image-preprocessing">Image preprocessing<a class="anchor-link" href="#Image-preprocessing"> </a></h3>$$
\begin{align*}
&amp;\textbf{for} \text{ sampled minibatch} \{x\}^{N}_{k=1} \textbf{ do}\\
&amp;\ \ \textbf{for} \text{ all k} \in \{1, ... , N\} \textbf{ do}\\
&amp;\ \ \ \ \text{draw two augmentation functions } \mathcal{t} \sim \mathcal{T}, \mathcal{t'} \sim \mathcal{T}\\
&amp;\ \ \ \ \tilde{x}_{2k-1} = \mathcal{t(x_k)} \ \ \tilde{x}_{2k} = \mathcal{t'(x_k)}
\end{align*}
$$<p><code>preprocess_for_train</code> can be seen as $\mathcal{T}$ in the training setting. For aditional implementation details, see <a href="https://github.com/google-research/simclr/blob/master/data_util.py">simclr/data_util.py</a>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">data_util</span> <span class="kn">import</span> <span class="n">random_crop_with_resize</span><span class="p">,</span> <span class="n">random_color_jitter</span>

<span class="k">def</span> <span class="nf">preprocess_for_train</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
                     <span class="n">color_distort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flip</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Preprocesses the given image for training.</span>
<span class="sd">    Args:</span>
<span class="sd">    image: `Tensor` representing an image of arbitrary size.</span>
<span class="sd">    height: Height of output image.</span>
<span class="sd">    width: Width of output image.</span>
<span class="sd">    color_distort: Whether to apply the color distortion.</span>
<span class="sd">    crop: Whether to crop the image.</span>
<span class="sd">    flip: Whether or not to flip left and right of an image.</span>
<span class="sd">    Returns:</span>
<span class="sd">    A preprocessed image `Tensor`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">crop</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">random_crop_with_resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flip</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">random_flip_left_right</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color_distort</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">random_color_jitter</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">[</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">image</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="NT-Xent--loss">NT-Xent  loss<a class="anchor-link" href="#NT-Xent--loss"> </a></h3><p>
$$ \mathsf{sim}(u,v) = \dfrac{u^\intercal v}{\|u\|\|v\|} $$
</p>
<p>
$$ \ $$
</p>
<p>
$$ \ell_{i,j} = -\log \dfrac{\exp \mathsf{sim}(z_i, z_j) / \tau}{ \sum_{k=1}^{2N} \mathbb{1}_{[k \ne i]} \exp \mathsf{sim}(z_i, z_j) / \tau} , \ \ \ \ (1) $$
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Where <code>x</code> and <code>v</code> can be $z_i$ and $z_j$, in no particular order. For aditional implementation details, see <a href="https://github.com/google-research/simclr/blob/master/objective.py">simclr/objective.py</a>.</p>
<div class="highlight"><pre><span></span><span class="n">LARGE_NUM</span> <span class="o">=</span> <span class="mf">1e9</span>

<span class="k">def</span> <span class="nf">nt_xent_loss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">masks</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">),</span> <span class="n">batch_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">logits_x_x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transpose_b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">temperature</span>
    <span class="n">logits_x_x</span> <span class="o">=</span> <span class="n">logits_x_x</span> <span class="o">-</span> <span class="n">masks</span> <span class="o">*</span> <span class="n">LARGE_NUM</span>

    <span class="n">logits_v_v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">transpose_b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">temperature</span>
    <span class="n">logits_v_v</span> <span class="o">=</span> <span class="n">logits_v_v</span> <span class="o">-</span> <span class="n">masks</span> <span class="o">*</span> <span class="n">LARGE_NUM</span>

    <span class="n">logits_x_v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">transpose_b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">temperature</span>
    <span class="n">logits_v_x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transpose_b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="n">temperature</span>

    <span class="n">loss_x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax_cross_entropy_with_logits</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">logits_x_v</span><span class="p">,</span> <span class="n">logits_x_x</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">loss_v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax_cross_entropy_with_logits</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">logits_v_x</span><span class="p">,</span> <span class="n">logits_v_v</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">loss_x</span> <span class="o">+</span> <span class="n">loss_v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loss</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Acknowledgements">Acknowledgements<a class="anchor-link" href="#Acknowledgements"> </a></h1><p>I would like to thank the authors for this incredibly well written and clear contribution.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="References">References<a class="anchor-link" href="#References"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><div class="footnotes"><p id="fn-1">1. A Simple Framework for Contrastive Learning of Visual Representations. Chen, T., Kornblith, S., Norouzi, M., &amp; Hinton, G. - 2020<a href="#fnref-1" class="footnote footnotes">↩</a></p></div></p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/notes-simclr-framework" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Computers, software, machine learning, and other random thoughts.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/lagejoao" title="lagejoao"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/_joaolage" title="_joaolage"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
